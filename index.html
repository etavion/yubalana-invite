<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Video</title>

<style>
html,body{
    margin:0;
    padding:0;
    background:white;
    height:100%;
    scroll-behavior: smooth;
}

/* VIDEO TIDAK DIUBAH */
video{
    width:100vw;
    height:100vh;
    object-fit:cover;
}

/* ====== BAGIAN EFEK GAMBAR ====== */
.scroll-section{
    width:100vw;
    height:100vh;
    overflow:hidden;
    background:white;
}

.scroll-img{
    width:100%;
    height:100%;
    object-fit:cover;
    opacity:0;
    transform:translateY(40px);
    transition:1.2s ease;
}

.scroll-img.show{
    opacity:1;
    transform:translateY(0);
}
</style>
</head>

<body>

<!-- ====== AUDIO ====== -->
<audio id="bgm" src="audio.mp3" preload="auto"></audio>

<!-- ====== VIDEO ====== -->
<video id="vid" controls playsinline poster="poster.png">
    <source src="video.mp4" type="video/mp4">
</video>

<!-- ====== GAMBAR ====== -->
<section class="scroll-section" id="hal1">
    <img src="hal1.png" class="scroll-img">
</section>
<section class="scroll-section">
    <img src="hal2.png" class="scroll-img">
</section>
<section class="scroll-section">
    <img src="hal3.png" class="scroll-img">
</section>
<section class="scroll-section">
    <img src="hal4.png" class="scroll-img">
</section>

<!-- ====== SCRIPT ====== -->
<script>
/* ========== ANIMASI FADE IN GAMBAR ========== */
const imgs = document.querySelectorAll(".scroll-img");
const observer = new IntersectionObserver(entries=>{
    entries.forEach(entry=>{
        if(entry.isIntersecting) entry.target.classList.add("show");
    });
},{ threshold: 0.2 });
imgs.forEach(img => observer.observe(img));


/* =====================================================
   SISTEM AUDIO
===================================================== */

const bgm = document.getElementById("bgm");
const vid = document.getElementById("vid");
let audioUnlocked = false;

/* === STEP 1 — UNLOCK AUDIO === */
vid.addEventListener("play", () => {
    if (!audioUnlocked) {
        bgm.play().then(()=>{
            bgm.pause();
            audioUnlocked = true;
        }).catch(()=>{});
    }
});


/* === STEP 2 — PLAY AUDIO saat HAL 1 terlihat === */
const hal1 = document.getElementById("hal1");

const startMusicObserver = new IntersectionObserver(entries=>{
    entries.forEach(entry=>{
        if(entry.isIntersecting && audioUnlocked){
            bgm.play().catch(()=>{});
        }
    });
},{ threshold: 0.4 });

startMusicObserver.observe(hal1);


/* === STEP 3 — AUTO PAUSE jika keluar aplikasi === */
document.addEventListener("visibilitychange", ()=>{
    if(document.hidden){
        bgm.pause();
    } else {
        if(audioUnlocked){
            bgm.play().catch(()=>{});
        }
    }
});


/* =====================================================
   FITUR BARU:
   VIDEO AUTO-PAUSE BEGITU DI-SCROLL SEDIKIT
===================================================== */

let scrollPauseEnabled = false;

// Aktifkan fitur setelah video diputar
vid.addEventListener("play", () => {
    scrollPauseEnabled = true;
});

// Deteksi scroll
window.addEventListener("scroll", () => {
    if (scrollPauseEnabled && !vid.paused) {
        vid.pause();
        scrollPauseEnabled = false;  // supaya tidak terus pause berkali-kali
    }
});
</script>

</body>
</html>
